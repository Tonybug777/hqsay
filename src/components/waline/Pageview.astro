---
import config from '@/site-config'
---

<script
  is:inline
  type='module'
  data-astro-rerun
  define:vars={{ walineServer: config.integ.waline.server }}
>
  async function loadPageview() {
    try {
      // ✅ 从本地 public 加载
      const pageview = await import('/waline-pageview.js')
      const el = document.querySelector('.waline-pageview-count')
      if (el) {
        return pageview.pageviewCount({
          serverURL: walineServer,
          path: window.location.pathname
        })
      }
    } catch (e) {
      console.error('Failed to load Waline pageview:', e)
    }
    return () => {}
  }

  const abort = await loadPageview()
  setTimeout(() => abort(), 500)
</script>